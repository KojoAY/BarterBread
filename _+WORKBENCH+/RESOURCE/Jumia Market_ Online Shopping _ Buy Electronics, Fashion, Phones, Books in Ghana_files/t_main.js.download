/*! Copyright © 2015 accengage-web-sdk 2.1.5 by Accengage */
"use strict";!function(a){"AccengageWebSDKObject"in a&&!function(a){function b(){if(f()&&d()){if(1===a.i.initFlag)return h.settings=i,h.utils.setContext(a.i),h.mode=h.MODE.TOP,h.top.prepare();if(2===a.i.initFlag){if(h.settings=i,h.utils.setContext(a.i),h.context.window.name===h.MODE.MIDDLE.PROXY)return h.mode=h.MODE.MIDDLE.PROXY,h.middle.prepare();if(h.context.window.name===h.MODE.MIDDLE.BRIDGE)return h.mode=h.MODE.MIDDLE.BRIDGE,h.middle.prepare()}}}function c(){return"function"===g(a)&&("boolean"!==g(a.a)&&(a.a=!0,"object"===g(a.i)))}function d(){return"number"===g(a.i.date)&&["global","window"].indexOf(g(a.i.window)!==-1)&&"htmldocument"===g(a.i.document)&&"number"===g(a.i.initFlag)}function f(){return"string"===g(i.partnerId)&&""!==i.partnerId&&("string"===g(i.A4SKey)&&""!==i.A4SKey)}function g(a){var b=Object.prototype.toString.call(a);return b.slice(8,b.length-1).toLowerCase()}if(c()){var h={};h.MODE={NONE:"none",TOP:"acc_top",MIDDLE:{PROXY:"acc_proxy",BRIDGE:"acc_bridge",LANDING:"acc_landing_push_optinisation"}},h.MASTER={BASE:"/pushweb/assets",PATH_TO_MIDDLE:"/m_main.html",PATH_TO_LANDING:"/index.html",PATH_TO_CONFIG:"/config.json",PATH_TO_WW:"/d_main.js",PATH_TO_SW:"/"},h.CDN={DOMAIN:"websdk.accengage.net",BASE:""},h.WIDGET={DEBUG:"debug",SUBTRACK:"subtrack"},h.SDK_VERSION="2.1.5",h.LOCATION={TOP:"top",MIDDLE:"middle",DOWN:"down"};var i={partnerId:"rocketinternet3ebba0c3d75b2d7",A4SKey:"bndkdev",alias:"jumia-market-by.accengage.net",version:"v2.1.x","default":{urlClick:"https://market.jumia.com.ng/",icon:"https://mobilecrm.accengage.com/images/logo_application/1648.png"},dependencies:{"push":{"scenario":"none","alertOptions":{"reAskingDelay":168,"theme":"blank","contents":{"misc":{"en":"<div class=\"grid3\"><center><img src=\"https://static-staging-market.jumia.co.ke//cms/logos/icon-market-48.png\" style=\"width: 70%; vertical-align: middle; margin-top: 30%;\" class=\"image1\" alt=\"\"></center></div><div class=\"grid9\"><p id=\"acc-alert-content\" style=\"padding-top: 0px !important;\">We would love to keep you updated about our latest deals.</p><p id=\"acc-alert-subcontent\">Deactivate alerts anytime through browser settings</p></div>","fr":"<div class=\"grid3\"><center><img src=\"https://static-staging-market.jumia.co.ke//cms/logos/icon-market-48.png\" style=\"width: 70%; vertical-align: middle; margin-top: 30%;\" class=\"image1\" alt=\"\"></center></div><div class=\"grid9\"><p id=\"acc-alert-content\" style=\"padding-top: 0px !important;\">Acceptez-vous de recevoir des alertes sur nos dernières offres?</p><p id=\"acc-alert-subcontent\">Désactivez les alertes à tout moment depuis les paramètres</p></div>"},"deny":{"en":"Don't Allow","fr":"Non Merci"},"accept":{"en":"Allow","fr":"OK!"}}}}},widgets:{"subtrack":{"propertyId":"UA-75949512-4"}}};h.settings={},h.context={},h.references={proxy:null,down:null},h.mode=h.MODE.NONE,"function"!=typeof Object.assign&&(Object.assign=function(a){if(null==a)throw new TypeError("Cannot convert undefined or null to object");a=Object(a);for(var b=1;b<arguments.length;b++){var c=arguments[b];if(null!=c)for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}),h.eventManager=function(){var a="manager:event",b={},c=function(a){return"object"==typeof a&&"object"==typeof a.data&&"string"==typeof a.data.type};return{getMessageBody:function(a){var b;try{b=JSON.parse(a.data.body)}catch(c){return a.data.body}return b},getMessagePayload:function(a){return"object"===h.utils.extendedTypeOf(a.data)?a.data:void 0},getMessageTopic:function(a){return"string"==typeof a.data.topic?a.data.topic:void 0},getMessageType:function(a){return"string"==typeof a.data.type?a.data.type:void 0},list:function(){return Object.keys(b)},bind:function(a){var b;for(b in a)this.add(b,a[b])},add:function(a,c){b[a]=c},remove:function(a){delete b[a]},exist:function(a){return b.hasOwnProperty(a)},trigger:function(d){var e,f;if(!c(d))return void h.widgetManager.fire(h.WIDGET.DEBUG,{type:"warning",callee:a,contents:["Unvalid event",d]});e=this.getMessageType(d);{if(this.exist(e))return b[e].apply(this,[d]);if(h.widgetManager.fire(h.WIDGET.DEBUG,{type:"warning",callee:a,contents:["Event type `"+e+"` does not exist",d]}),f=this.getMessageTopic(d))return h.utils.downwardFeedback(f,null,"event type error")}}}}(),h.logicManager=function(){var a={};return{add:function(b,c){a[b]=c},apply:function(b,c,d){try{if(d=d||{},!a.hasOwnProperty(b))throw new Error("Unknown method");return a[b].apply(h,[c,d])}catch(e){var f="misc error";if("string"===g(e)?f=e:"error"!==g(e)||h.utils.empty(e.message)||(f=e.message),"onError"in d)return d.onError.apply(this,[f]);throw f}},exist:function(b){return a.hasOwnProperty(b)},list:function(){return a},remove:function(b){delete a[b]}}}(),h.dependencyManager=function(){var a={},b=[],c=[],d=!1;return{dependencyLoaded:function(a){b.push(a)},dependencyPrepared:function(a){c.push(a)},getIncludedResources:function(){return a},isDependencyLoaded:function(a){return b.indexOf(a)!==-1},isDependencyPrepared:function(a){return c.indexOf(a)!==-1},isSDKLoaded:function(){return d},prepareDependency:function(a){h.utils.empty(h[a])||"function"!==h.utils.extendedTypeOf(h[a].prepare)||h[a].prepare()},resourceIncluded:function(b,c){a.hasOwnProperty(b)||(a[b]=[]),a[b].push(c)},setSDKLoaded:function(a){d=a},startDependencies:function(){for(var a=0;a<b.length;a++)h.utils.empty(h[b[a]])||"function"!==h.utils.extendedTypeOf(h[b[a]].start)||h[b[a]].start()}}}(),h.widgetManager=function(){var a={"top:debug":"/t_w_debug.js","middle:subtrack":"/m_w_subtrack.js"},b={},c={},d=[];h.eventManager.add("_fireWidget",function(a){var b=h.eventManager.getMessageBody(a);e(b)&&h.widgetManager.fire(b.widget,b.options)});var e=function(a){return"object"===h.utils.extendedTypeOf(a)&&"string"===h.utils.extendedTypeOf(a.widget)},f=function(b){if(d.indexOf(b)===-1){var c="https://"+h.CDN.DOMAIN+h.CDN.BASE;h.utils.empty(h.settings.version)||(c+="/"+h.settings.version),c+=a[b],h.utils.loadJS(c)}};return{fire:function(a,b){(c[a]=c[a]||[]).push(b)},getDebugQueryParams:function(){var a="";return h.utils.empty(h.settings.widgets.debug)||h.utils.empty(h.settings.widgets.debug.key)||(a+="&ACCdebugKey="+h.settings.widgets.debug.key,a+="&ACCdebugMode="+(h.utils.empty(h.settings.widgets.debug.mode)?1:h.settings.widgets.debug.mode),a+="&ACCtimestamp="+1*new Date),a},getQueues:function(){return c},init:function(a){a=h.utils.extend(b,a||{});var c;for(c in a)if("object"===h.utils.extendedTypeOf(a[c]))switch(c){case h.WIDGET.DEBUG:f("top:debug");break;case h.WIDGET.SUBTRACK:h.mode!==h.MODE.MIDDLE.PROXY&&h.mode!==h.MODE.MIDDLE.LANDING||f("middle:subtrack")}},resourceIncluded:function(a){d.push(a)}}}(),h.customEventManager=function(){var a={},b=[],c=function(a){b.indexOf(a)===-1&&b.push(a)},d=function(){var c,d;for(c=b.length-1;c>=0;c--)d=b[c],d in a&&"function"==typeof a[d]&&(b.splice(c,1),h.customEventManager.trigger(d))};return{add:function(b,c){var e=[];return"array"!==h.utils.extendedTypeOf(c)&&(c=[]),Object.keys(b).forEach(function(d){"function"==typeof b[d]&&c.indexOf(d)!==-1&&(a[d]=b[d],e.push(d))}),d(),e},trigger:function(b,d){return d=d||!1,b in a&&"function"==typeof a[b]?void a[b]():void(d?c(b):h.widgetManager.fire(h.WIDGET.DEBUG,{type:"warning",callee:"manager:custom_event",content:"Custom event name `"+b+"` not registered"}))}}}(),function(a){function b(a){try{if(e={},"chrome"in a){var b=a.navigator.userAgent.match(/Chrome\/([\d]*)/);if(!b||"string"!=typeof b[1])throw"No `Chrome` in user-agent";return e.browserName="chrome",e.browserVersion=parseInt(b[1],10),void(e.devicePlatform=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(a.navigator.userAgent)?"mobile":"desktop")}if(a.navigator.userAgent.toLowerCase().indexOf("firefox")!==-1){var b=a.navigator.userAgent.match(/Firefox\/([\d]*)/);return e.browserName="firefox",e.browserVersion=parseInt(b[1],10),void(e.devicePlatform=a.navigator.userAgent.toLowerCase().indexOf("android")!==-1?"mobile":"desktop")}throw"Neither Chrome nor Firefox browser"}catch(c){e=!1}}function c(a){return"[object Function]"!==Object.prototype.toString.call(a[a[d]])&&(a[a[d]]=function(){}),a[a[d]]}a.init={};var d="AccengageWebSDKObject",e=void 0;a.init.getBrowserProperties=function(a){return"undefined"==typeof e&&b(a),e},a.init.isBrowserTargeted=function(a,c){var d,f;if("undefined"==typeof e&&b(a),e===!1)throw"Browser not compliant";for(d=0;d<c.length;d++)if(f=c[d],e.browserName===f.name&&!("platform"in f&&e.devicePlatform!==f.platform||"min"in f&&e.browserVersion<f.min||"max"in f&&e.browserVersion>f.max))return;throw"Browser not targeted"},a.init.isCompliantForWebNotification=function(a){if(!("ServiceWorker"in a&&"Notification"in a))throw"Browser not compliant for web notification"},a.init.getProtoArray=function(a){if(!(d in a))throw"`"+d+"` reference does not exist";if(!(a[d]in a))throw"Proto Array does not exist";if("[object Function]"===Object.prototype.toString.call(a[a[d]]))throw"Proto Array already treated";if("[object Array]"!==Object.prototype.toString.call(a[a[d]]))throw"Proto Array is not an array type";return a[a[d]]},a.init.setProxyParams=function(a,b){c(a).i=b},a.init.setProxyCommandQueue=function(a,b){c(a).q=b||[],c(a).push=function(){c(a).q.push(arguments)}},a.init.loadEntryPoint=function(a,b,c){var d=b.createElement("script"),e=b.getElementsByTagName("script")[0];d.async=1,d.src=c,e.parentNode.insertBefore(d,e)}}(h),function(a){function b(b){var c;try{if(c=a.context.document.getElementById(b),"object"!=typeof c)return;return c}catch(d){return}}a.utils={},/** @license MIT License - https://bitbucket.org/pellepim/jstimezonedetect/src/default/LICENCE.txt Copyright (c) Jon Nylander */
function(a){var b=function(){var a="s",c={DAY:864e5,HOUR:36e5,MINUTE:6e4,SECOND:1e3,BASELINE_YEAR:2014,MAX_SCORE:864e6,AMBIGUITIES:{"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":["Asia/Amman","Asia/Jerusalem","Europe/Helsinki","Asia/Damascus","Africa/Cairo","Asia/Gaza","Europe/Minsk"],"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk","Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]}},d=function(a){var b=-a.getTimezoneOffset();return null!==b?b:0},e=function(){var b=d(new Date(c.BASELINE_YEAR,0,2)),e=d(new Date(c.BASELINE_YEAR,5,2)),f=b-e;return f<0?b+",1":f>0?e+",1,"+a:b+",0"},f=function(){var a,b;if("undefined"!=typeof Intl&&"undefined"!=typeof Intl.DateTimeFormat&&(a=Intl.DateTimeFormat(),"undefined"!=typeof a&&"undefined"!=typeof a.resolvedOptions))return b=a.resolvedOptions().timeZone,b&&(b.indexOf("/")>-1||"UTC"===b)?b:void 0},g=function(a){for(var b=new Date(a,0,1,0,0,1,0).getTime(),c=new Date(a,12,31,23,59,59).getTime(),d=b,e=new Date(d).getTimezoneOffset(),f=null,g=null;d<c-864e5;){var i=new Date(d),j=i.getTimezoneOffset();j!==e&&(j<e&&(f=i),j>e&&(g=i),e=j),d+=864e5}return!(!f||!g)&&{s:h(f).getTime(),e:h(g).getTime()}},h=function(a,b,d){for(var e=!0;e;){var f=a,g=b,h=d;e=!1,"undefined"==typeof g&&(g=c.DAY,h=c.HOUR);for(var i=new Date(f.getTime()-g).getTime(),j=f.getTime()+g,k=new Date(i).getTimezoneOffset(),l=i,m=null;l<j-h;){var n=new Date(l),o=n.getTimezoneOffset();if(o!==k){m=n;break}l+=h}if(g!==c.DAY){if(g!==c.HOUR)return m;a=m,b=c.MINUTE,d=c.SECOND,e=!0,i=j=k=l=m=n=o=void 0}else a=m,b=c.HOUR,d=c.MINUTE,e=!0,i=j=k=l=m=n=o=void 0}},i=function(a,b,c,d){if("N/A"!==c)return c;if("Asia/Beirut"===b){if("Africa/Cairo"===d.name&&13983768e5===a[6].s&&14116788e5===a[6].e)return 0;if("Asia/Jerusalem"===d.name&&13959648e5===a[6].s&&14118588e5===a[6].e)return 0}else if("America/Santiago"===b){if("America/Asuncion"===d.name&&14124816e5===a[6].s&&1397358e6===a[6].e)return 0;if("America/Campo_Grande"===d.name&&14136912e5===a[6].s&&13925196e5===a[6].e)return 0}else if("America/Montevideo"===b){if("America/Sao_Paulo"===d.name&&14136876e5===a[6].s&&1392516e6===a[6].e)return 0}else if("Pacific/Auckland"===b&&"Pacific/Fiji"===d.name&&14142456e5===a[6].s&&13961016e5===a[6].e)return 0;return c},j=function(a,d){for(var e=function(b){for(var e=0,f=0;f<a.length;f++)if(b.rules[f]&&a[f]){if(!(a[f].s>=b.rules[f].s&&a[f].e<=b.rules[f].e)){e="N/A";break}if(e=0,e+=Math.abs(a[f].s-b.rules[f].s),e+=Math.abs(b.rules[f].e-a[f].e),e>c.MAX_SCORE){e="N/A";break}}return e=i(a,d,e,b)},f={},g=b.olson.dst_rules.zones,h=g.length,j=c.AMBIGUITIES[d],k=0;k<h;k++){var l=g[k],m=e(g[k]);"N/A"!==m&&(f[l.name]=m)}for(var n in f)if(f.hasOwnProperty(n))for(var o=0;o<j.length;o++)if(j[o]===n)return n;return d},k=function(a){var c=function(){for(var a=[],c=0;c<b.olson.dst_rules.years.length;c++){var d=g(b.olson.dst_rules.years[c]);a.push(d)}return a},d=function(a){for(var b=0;b<a.length;b++)if(a[b]!==!1)return!0;return!1},e=c(),f=d(e);return f?j(e,a):a},l=function(){var a=f();return a||(a=b.olson.timezones[e()],"undefined"!=typeof c.AMBIGUITIES[a]&&(a=k(a))),{name:function(){return a}}};return{determine:l}}();b.olson=b.olson||{},b.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},b.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572e5,s:12090744e5},{e:1250802e6,s:1240524e6},{e:12858804e5,s:12840696e5},!1,!1,!1,{e:14116788e5,s:1406844e6}]},{name:"Africa/Casablanca",rules:[{e:12202236e5,s:12122784e5},{e:12508092e5,s:12438144e5},{e:1281222e6,s:12727584e5},{e:13120668e5,s:13017888e5},{e:13489704e5,s:1345428e6},{e:13828392e5,s:13761e8},{e:14142888e5,s:14069448e5}]},{name:"America/Asuncion",rules:[{e:12050316e5,s:12243888e5},{e:12364812e5,s:12558384e5},{e:12709548e5,s:12860784e5},{e:13024044e5,s:1317528e6},{e:1333854e6,s:13495824e5},{e:1364094e6,s:1381032e6},{e:13955436e5,s:14124816e5}]},{name:"America/Campo_Grande",rules:[{e:12032172e5,s:12243888e5},{e:12346668e5,s:12558384e5},{e:12667212e5,s:1287288e6},{e:12981708e5,s:13187376e5},{e:13302252e5,s:1350792e6},{e:136107e7,s:13822416e5},{e:13925196e5,s:14136912e5}]},{name:"America/Goose_Bay",rules:[{e:122559486e4,s:120503526e4},{e:125704446e4,s:123648486e4},{e:128909886e4,s:126853926e4},{e:13205556e5,s:129998886e4},{e:13520052e5,s:13314456e5},{e:13834548e5,s:13628952e5},{e:14149044e5,s:13943448e5}]},{name:"America/Havana",rules:[{e:12249972e5,s:12056436e5},{e:12564468e5,s:12364884e5},{e:12885012e5,s:12685428e5},{e:13211604e5,s:13005972e5},{e:13520052e5,s:13332564e5},{e:13834548e5,s:13628916e5},{e:14149044e5,s:13943412e5}]},{name:"America/Mazatlan",rules:[{e:1225008e6,s:12074724e5},{e:12564576e5,s:1238922e6},{e:1288512e6,s:12703716e5},{e:13199616e5,s:13018212e5},{e:13514112e5,s:13332708e5},{e:13828608e5,s:13653252e5},{e:14143104e5,s:13967748e5}]},{name:"America/Mexico_City",rules:[{e:12250044e5,s:12074688e5},{e:1256454e6,s:12389184e5},{e:12885084e5,s:1270368e6},{e:1319958e6,s:13018176e5},{e:13514076e5,s:13332672e5},{e:13828572e5,s:13653216e5},{e:14143068e5,s:13967712e5}]},{name:"America/Miquelon",rules:[{e:12255984e5,s:12050388e5},{e:1257048e6,s:12364884e5},{e:12891024e5,s:12685428e5},{e:1320552e6,s:12999924e5},{e:13520016e5,s:1331442e6},{e:13834512e5,s:13628916e5},{e:14149008e5,s:13943412e5}]},{name:"America/Santa_Isabel",rules:[{e:12250116e5,s:1207476e6},{e:12564612e5,s:12389256e5},{e:12885156e5,s:12703752e5},{e:13199652e5,s:13018248e5},{e:13514148e5,s:13332744e5},{e:13828644e5,s:13653288e5},{e:1414314e6,s:13967784e5}]},{name:"America/Santiago",rules:[{e:1206846e6,s:1223784e6},{e:1237086e6,s:12552336e5},{e:127035e7,s:12866832e5},{e:13048236e5,s:13138992e5},{e:13356684e5,s:13465584e5},{e:1367118e6,s:13786128e5},{e:13985676e5,s:14100624e5}]},{name:"America/Sao_Paulo",rules:[{e:12032136e5,s:12243852e5},{e:12346632e5,s:12558348e5},{e:12667176e5,s:12872844e5},{e:12981672e5,s:1318734e6},{e:13302216e5,s:13507884e5},{e:13610664e5,s:1382238e6},{e:1392516e6,s:14136876e5}]},{name:"Asia/Amman",rules:[{e:1225404e6,s:12066552e5},{e:12568536e5,s:12381048e5},{e:12883032e5,s:12695544e5},{e:13197528e5,s:13016088e5},!1,!1,{e:14147064e5,s:13959576e5}]},{name:"Asia/Damascus",rules:[{e:12254868e5,s:120726e7},{e:125685e7,s:12381048e5},{e:12882996e5,s:12701592e5},{e:13197492e5,s:13016088e5},{e:13511988e5,s:13330584e5},{e:13826484e5,s:1364508e6},{e:14147028e5,s:13959576e5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572e5,s:12066552e5},{e:12520152e5,s:12381048e5},{e:1281474e6,s:126964086e4},{e:1312146e6,s:130160886e4},{e:13481784e5,s:13330584e5},{e:13802292e5,s:1364508e6},{e:1414098e6,s:13959576e5}]},{name:"Asia/Irkutsk",rules:[{e:12249576e5,s:12068136e5},{e:12564072e5,s:12382632e5},{e:12884616e5,s:12697128e5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612e5,s:12066624e5},{e:1254006e6,s:1238112e6},{e:1284246e6,s:12695616e5},{e:131751e7,s:1301616e6},{e:13483548e5,s:13330656e5},{e:13828284e5,s:13645152e5},{e:1414278e6,s:13959648e5}]},{name:"Asia/Kamchatka",rules:[{e:12249432e5,s:12067992e5},{e:12563928e5,s:12382488e5},{e:12884508e5,s:12696984e5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612e5,s:12068172e5},{e:12564108e5,s:12382668e5},{e:12884652e5,s:12697164e5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648e5,s:12068208e5},{e:12564144e5,s:12382704e5},{e:12884688e5,s:126972e7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504e5,s:12068064e5},{e:12564e8,s:1238256e6},{e:12884544e5,s:12697056e5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954e6,s:120681e7},{e:12564036e5,s:12382596e5},{e:1288458e6,s:12697092e5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684e5,s:12068244e5},{e:1256418e6,s:1238274e6},{e:12884724e5,s:12697236e5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972e6,s:1206828e6},{e:12564216e5,s:12382776e5},{e:1288476e6,s:12697272e5},{e:13199256e5,s:13011768e5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076e5,s:12231342e5},{e:12388572e5,s:12545838e5},{e:12703068e5,s:12860334e5},{e:13017564e5,s:1317483e6},{e:1333206e6,s:13495374e5},{e:13652604e5,s:1380987e6},{e:139671e7,s:14124366e5}]},{name:"Australia/Perth",rules:[{e:12068136e5,s:12249576e5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]},{name:"Europe/Minsk",rules:[{e:12249792e5,s:12068352e5},{e:12564288e5,s:12382848e5},{e:12884832e5,s:12697344e5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756e5,s:12068316e5},{e:12564252e5,s:12382812e5},{e:12884796e5,s:12697308e5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528e5,s:13168728e5},{e:13332024e5,s:13489272e5},{e:13652568e5,s:13803768e5},{e:13967064e5,s:14118264e5}]},{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984e5,s:12878424e5},{e:13271544e5,s:1319292e6},{e:1358604e6,s:13507416e5},{e:139005e7,s:1382796e6},{e:14215032e5,s:14148504e5}]},{name:"Europe/London",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]}]},a.jstz=b}(a),a.utils.setContext=function(b){var c,d,e={startDate:b.date,window:b.window,document:b.document};e=a.utils.extend(e,a.init.getBrowserProperties(e.window)),e.isHTTPS="https:"===e.window.location.protocol,e.currentDomain=e.window.location.hostname,c=e.window.navigator.languages?e.window.navigator.languages[0]:e.window.navigator.language||e.window.navigator.userLanguage,c=c.split("-"),e.language="string"===a.utils.extendedTypeOf(c[0])?c[0].toLowerCase():"",e.countryCode="string"===a.utils.extendedTypeOf(c[1])?c[1].toLowerCase():"",d=a.jstz.determine(),e.timeZone=d.name()||"",a.context=e},a.utils.loadJS=function(b){var c=a.context.document.createElement("script"),d=a.context.document.getElementsByTagName("script")[0];c.async=1,c.src=b,d.parentNode.insertBefore(c,d)},a.utils.loadCSS=function(b){var c=a.context.document.createElement("link"),d=a.context.document.getElementsByTagName("head")[0];c.rel="stylesheet",c.type="text/css",c.media="all",c.href=b,d.appendChild(c)},a.utils.onSuccess=function(b,c){var d;if("object"===a.utils.extendedTypeOf(b)&&"onSuccess"in b)return d=b.onSuccess,delete b.onSuccess,d(c)},a.utils.onError=function(b,c){var d;if("object"===a.utils.extendedTypeOf(b)&&"onError"in b)return d=b.onError,delete b.onError,d(a.utils.errorToString(c))},a.utils.errorToString=function(a){return"object"==typeof a&&"message"in a?a.message:"string"==typeof a?a:"misc error"},a.utils.payloadToString=function(b){return["object","array"].indexOf(a.utils.extendedTypeOf(b))===-1?b:JSON.stringify(b)},a.utils.extend=function(a,b){var c,d={};for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(d[c]=a[c]);for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c]);return d},a.utils.extendedTypeOf=function(a){var b=Object.prototype.toString.call(a);return b.slice(8,b.length-1).toLowerCase()},a.utils.typeOf=a.utils.extendedTypeOf,a.utils.xhr=function(){var a=new XMLHttpRequest;return function(b,c,d){a.onreadystatechange=function(){4===a.readyState&&d(a.responseText)},a.open(b,c),a.send()}}(),a.utils.createIframe=function(b,c){var d=a.context.document.createElement("iframe");return d.src=b,d.height=d.width=1,d.name=c,d.style.border="none",d},a.utils.getMiddleFileURI=function(){return"https://"+a.settings.alias+a.MASTER.BASE+a.MASTER.PATH_TO_MIDDLE},a.utils.getMessageBody=function(a){var b;try{b=JSON.parse(a.data.body)}catch(c){return a.data.body}return b},a.utils.createPayloadMessage=function(b,c){var d={};if(b)return d.type=b,d.body=a.utils.payloadToString(c),d},a.utils.createPayloadFeedback=function(b,c,d){var e={};if(b){if(e.type=b,d)e.error=a.utils.errorToString(d);else{if(!c)return;e.body=a.utils.payloadToString(c)}return e}},a.utils.getMessageTopic=function(a){return"string"==typeof a.data.topic?a.data.topic:void 0},a.utils.empty=function(a){var b,c,d,e,f=[b,null,!1,0,"","0"];for(d=0,e=f.length;d<e;d++)if(a===f[d])return!0;if("object"==typeof a){for(c in a)return!1;return!0}return!1},a.utils.grep=function(b,c){var d,e,f=[];if("object"===a.utils.extendedTypeOf(b))for(d in b)b[d]===c&&f.push(d);else if("array"===a.utils.extendedTypeOf(b))for(e=0;e<b.length;e++)b[e]===c&&f.push(d);return f},a.utils.firstProp=function(a){for(var b in a)if(a.hasOwnProperty(b)&&"function"!=typeof b)return b;return null},a.utils.getISOTimestampDate=function(a){return a="undefined"!=typeof a?parseInt(a,10):0,new Date(Date.now()+a).toISOString()},a.utils.isValidDate=function(b){return"date"===a.utils.extendedTypeOf(b)&&!isNaN(b.getTime())},a.utils.show=function(a){var c="string"==typeof a?b(a):a;c&&(c.style.display="block")},a.utils.hide=function(a){var c="string"==typeof a?b(a):a;c&&(c.style.display="none")},a.utils.hasClass=function(a,c){var d="string"==typeof a?b(a):a;if(d)return new RegExp(" "+c+" ").test(" "+d.className+" ")},a.utils.addClass=function(c,d){var e="string"==typeof c?b(c):c;e&&(a.utils.hasClass(e,d)||(e.className+=" "+d))},a.utils.removeClass=function(a,c){var d="string"==typeof a?b(a):a;if(d){var e=" "+d.className.replace(/[\t\r\n]/g," ")+" ";if(this.hasClass(d,c)){for(;e.indexOf(" "+c+" ")>=0;)e=e.replace(" "+c+" "," ");d.className=e.replace(/^\s+|\s+$/g,"")}}},a.utils.getCSSRule=function(b,c,d,e){var f=function(a){return a+";"};return b+"{"+(c||[]).map(f).join("")+("desktop"===a.context.devicePlatform?(d||[]).map(f).join(""):(e||[]).map(f).join(""))+"}"},a.utils.createCookie=function(b,c,d){var e,f="",g=new Date;"number"==typeof d&&d>0&&(e=new Date,e.setTime(g.getTime()+60*d*60*1e3),f="; expires="+e.toGMTString()),a.context.document.cookie=b+"="+c+f+"; path=/"},a.utils.deleteCookie=function(b){a.context.document.cookie=b+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},a.utils.readCookie=function(b){b=b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1");var c=new RegExp("(?:^|;)\\s?"+b+"=(.*?)(?:;|$)","i"),d=a.context.document.cookie.match(c);return d&&d[1]},a.utils.getNavigatorLanguage=function(){var b=a.context.window.navigator.languages?a.context.window.navigator.languages[0]:a.context.window.navigator.language||a.context.window.navigator.userLanguage;return b=b.split("-")},a.utils.merge=function(a,b){return"undefined"==typeof a||null===a?a=[]:"[object Array]"!==Object.prototype.toString.call(a)&&(a=[a]),"undefined"==typeof b||null===b?b=[]:"[object Array]"!==Object.prototype.toString.call(b)&&(b=[b]),a.concat(b)},a.utils.generateUUID=function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b},a.utils.localizeContent=function(b,c){var d,e,f=a.context.language;try{if("object"!==a.utils.extendedTypeOf(c))throw"contents is not an object";if("string"===a.utils.extendedTypeOf(c[b]))d=c[b];else{if("object"!==a.utils.extendedTypeOf(c[b]))throw"no value provided";if(e=a.utils.firstProp(c[b]),"string"===a.utils.extendedTypeOf(c[b][f]))d=c[b][f];else{if(!e||"string"!==a.utils.extendedTypeOf(c[b][e]))throw"no string value provided";d=c[b][e]}}}catch(g){d=""}return d},a.utils.getQueryKey=function(b){var c,d,e,f=a.context.window.location.search.substring(1),g=f.split("&");for(c=0;c<g.length;c++)if(d=g[c].split("="),d[0]==b)return d[1].indexOf("%20")!=-1?(e=d[1].split("%20"),e[0]+" "+e[1]):d[1];return null},a.utils.isBrowserTargeted=function(b){try{a.init.isBrowserTargeted(a.context.window,b)}catch(c){return!1}return!0},a.utils.toJSON=function(a){return"toJSON"in a?Promise.resolve(a.toJSON()):Promise.resolve(a)},a.utils.parseJSON=function(a){try{return JSON.parse(a)}catch(b){return a}}}(h),function(b){function c(){o=a.q.slice(),a.q=[],a.q.push=function(){var a,c,d,e,g,h,j;if(a=Array.prototype.slice.call(arguments),"arguments"!==b.utils.extendedTypeOf(a[0])&&0===a[0].length&&"array"!==b.utils.extendedTypeOf(a[0][0])&&0===a[0][0].length)return void b.widgetManager.fire(b.WIDGET.DEBUG,{type:"error",contents:["Commands is not valid",a]});for(j=0;j<a[0].length;j++)c=a[0][j],"array"===b.utils.extendedTypeOf(c)&&c.length?(d=c[0],e=c[1],g=c[2],i(d)?(h=d.split(":")[0],b.dependencyManager.isDependencyPrepared(h)?f(d,e,g):(o.push([d,e,g]),b.widgetManager.fire(b.WIDGET.DEBUG,{type:"warning",content:"Dependency `"+h+"` not prepared yet, stored in pending queue"}))):b.widgetManager.fire(b.WIDGET.DEBUG,{type:"error",contents:["Command action is not valid",d]})):b.widgetManager.fire(b.WIDGET.DEBUG,{type:"error",contents:["Command is not an array nor filled",c]})}}function d(){var a=!0;a:for(;a;){a=!1;var c,d,e,f,g,h=[];for(c=o.length-1;c>=0;c--)if(f=o[c],"arguments"===b.utils.extendedTypeOf(f)){if(!f.length){o.splice(c,1),a=!0,c=d=e=f=g=h=void 0;continue a}for(d=0;d<f.length;d++)g=f[d],"array"===b.utils.extendedTypeOf(g)&&g.length?h.push(g):b.widgetManager.fire(b.WIDGET.DEBUG,{type:"error",contents:["Pending command were not an array type nor filled",g]});for(o.splice(c,1),e=h.length-1;e>=0;e--)o.splice(c,0,h[e]);a=!0,c=d=e=f=g=h=void 0;continue a}b.widgetManager.fire(b.WIDGET.DEBUG,{content:"Pending queue flattened, "+o.length+" commands pending"})}}function e(){var a=!0;a:for(;a;){a=!1;var c,d,e,g,h,j;if(!o.length)return;for(c=0;c<o.length;c++){if(d=o[c],"array"!==b.utils.extendedTypeOf(d)||!d.length){b.widgetManager.fire(b.WIDGET.DEBUG,{type:"error",contents:["Pending command is not an array nor filled",d]}),o.splice(c,1),a=!0,c=d=e=g=h=j=void 0;continue a}if(e=o[c][0],g=o[c][1],h=o[c][2],!i(e)){b.widgetManager.fire(b.WIDGET.DEBUG,{type:"warning",contents:["Pending command action is not valid, command trashed",e,JSON.stringify(o[c])]}),o.splice(c,1),a=!0,c=d=e=g=h=j=void 0;continue a}if(j=e.split(":")[0],b.dependencyManager.isDependencyPrepared(j)){o.splice(c,1),f(e,g,h),a=!0,c=d=e=g=h=j=void 0;continue a}}}}function f(a,c,d){return b.widgetManager.fire(b.WIDGET.DEBUG,{contents:["Applying command :",a,c,d]}),p.push([a,c,d]),"object"!==b.utils.extendedTypeOf(d)&&(d={}),b.logicManager.exist(a)?b.logicManager.apply(a,c,d):b.utils.downwardMessage(a,c,{onSuccess:function(a){return b.utils.onSuccess(d,a)},onError:function(c){var e=b.utils.errorToString(c);return"Event type does not exist"===e?b.utils.onError(d,"Given command `"+a+"` does not exist"):b.utils.onError(d,e)}})}function g(a,c){var d;return c=c||{},"object"!==b.utils.extendedTypeOf(a)?b.utils.onError(c,"Provided command options is not an object"):(d=b.customEventManager.add(a,["sdkLoaded"]),d.length?b.utils.onSuccess(c,d):b.utils.onError(c,"No listeners added"))}function h(){var a=b.utils.getMiddleFileURI()+"?"+b.widgetManager.getDebugQueryParams(),c=b.utils.createIframe(a,b.MODE.MIDDLE.PROXY),d=function(){b.widgetManager.fire(b.WIDGET.DEBUG,{type:"warning",content:"Middle is waiting for the <body> to be created. If you read this log, please note that this could mean that the `DOMContentLoaded` event takes some time to fire"}),b.context.document.addEventListener("DOMContentLoaded",function(){return e()},!1)},e=function(){return"object"!=typeof b.context.document.body.appendChild(c)?b.widgetManager.fire(b.WIDGET.DEBUG,{type:"error",content:"Middle has not been loaded, SDK loading state will then stop here."}):void(b.references.proxy=c.contentWindow)};return c.onload=function(a){b.context.window.addEventListener("message",function(a){b.eventManager.trigger(a)},!1)},"htmlbodyelement"!==b.utils.extendedTypeOf(b.context.document.body)?d():e()}function i(a){return"string"===b.utils.extendedTypeOf(a)&&!(a.indexOf(":")<1||"_"===a.charAt(0))}function j(a,c){return a.topic=b.utils.generateUUID(),b.eventManager.add(a.topic,function(d){return b.eventManager.remove(a.topic),!b.utils.empty(d.data.body)&&"onSuccess"in c?c.onSuccess.apply(this,[d.data.body]):!b.utils.empty(d.data.error)&&"onError"in c?c.onError.apply(this,[d.data.error]):void 0}),b.references.proxy.postMessage(a,b.utils.getMiddleFileURI())}function k(){var a=arguments.length<=0||void 0===arguments[0]?1:arguments[0],c=function(){b.utils.downwardMessage("_notifyIncludedResources",b.dependencyManager.getIncludedResources())};return a>20?b.widgetManager.fire("debug",{type:"error",content:"notifying middle process has reached its maximum attempt"}):(1===a?c():b.widgetManager.fire("debug",{content:"notifying middle (attempts="+a+")"}),void(m=setTimeout(function(){c(),k(++a)},1e3)))}function l(){clearTimeout(m)}b.top={};var m,n={},o=[],p=[];n._controllersPlugged=function(a){b.eventManager.remove("_controllersPlugged"),b.widgetManager.fire("debug",{type:"log",content:"`top` plugged"}),k()},n._stopNotifying=function(a){l()},n._dependencyLoaded=function(a){var c=b.eventManager.getMessageBody(a);b.dependencyManager.dependencyLoaded(c),b.widgetManager.fire(b.WIDGET.DEBUG,{content:"`"+c+"` loaded +"+(1*new Date-b.context.startDate)+" ms"}),b.dependencyManager.prepareDependency(c),["core","storage"].indexOf(c)!==-1&&b.dependencyManager.isDependencyLoaded("core")&&b.dependencyManager.isDependencyLoaded("storage")&&b.utils.downwardMessage("_core:instanciateUser",{browserName:b.context.browserName,browserVersion:b.context.browserVersion,countryCode:b.context.countryCode,devicePlatform:b.context.devicePlatform,language:b.context.language,time_zone:b.context.timeZone,__currentDomain:b.context.currentDomain,__currentVersion:b.SDK_VERSION},{onSuccess:function(a){a=JSON.parse(a),b.utils.downwardMessage("_fireWidget",{widget:b.WIDGET.SUBTRACK,options:{type:"start",clientId:a.UDID,masterDomain:b.settings.alias,navigatingDomain:a.__currentDomain}})}})},n._dependencyPrepared=function(a){var c=b.eventManager.getMessageBody(a);b.dependencyManager.dependencyPrepared(c),b.widgetManager.fire(b.WIDGET.DEBUG,{content:"`"+c+"` prepared +"+(1*new Date-b.context.startDate)+" ms"}),b.dependencyManager.isSDKLoaded()&&e()},n._sdkLoaded=function(){b.dependencyManager.setSDKLoaded(!0),b.widgetManager.fire(b.WIDGET.DEBUG,{type:"success",content:"SDK loaded +"+(1*new Date-b.context.startDate)+" ms"}),b.customEventManager.trigger("sdkLoaded",!0),b.utils.downwardMessage("_fireWidget",{widget:b.WIDGET.SUBTRACK,options:{type:"page",url:b.context.window.location.pathname}}),b.dependencyManager.startDependencies(),c(),d(),e()},n["_top:loadResource"]=function(a){var c=b.eventManager.getMessageBody(a);c&&b.utils.loadJS(c)},n["_top:isContextSecure"]=function(a){var c=b.eventManager.getMessageTopic(a);b.context.isHTTPS?b.utils.downwardFeedback(c,!0):b.utils.downwardFeedback(c,null,!0)},n._triggerCustomEvent=function(a){var c=b.eventManager.getMessageBody(a);"string"==typeof c&&b.customEventManager.trigger("string")},b.top.prepare=function(){return a.q=a.q||[],b.utils.downwardMessage=q,b.utils.downwardFeedback=r,b.widgetManager.init(b.settings.widgets),b.eventManager.bind(n),b.logicManager.add("core:addCustomListeners",g),b.widgetManager.fire(b.WIDGET.DEBUG,{contents:["`top` configured +"+(1*new Date-b.context.startDate)+" ms",b.settings]}),h()};var q=function(a,c,d){var e=b.utils.createPayloadMessage(a,c);if(e)return d?j(e,d):b.references.proxy.postMessage(e,b.utils.getMiddleFileURI())},r=function(a,c,d){var e=b.utils.createPayloadFeedback(a,c,d);if(e)return b.references.proxy.postMessage(e,b.utils.getMiddleFileURI())}}(h),function(a){function b(){a.references.down.onmessage=n,a.context.window.removeEventListener("message",h),a.context.window.addEventListener("message",o,!1)}function c(){var b=arguments.length<=0||void 0===arguments[0]?1:arguments[0],d=function(){a.utils.forwardMessage("_controllersPlugged")};return b>20?a.widgetManager.fire("debug",{type:"error",content:"notifying top retry process has reached its maximum attempt"}):(1===b?d():a.widgetManager.fire("debug",{content:"notifying top (attempts="+b+")"}),void(f=setTimeout(function(){d(),c(++b)},1e3)))}function d(){clearTimeout(f)}function e(b,c){return b.topic=a.utils.generateUUID(),a.eventManager.add(b.topic,function(d){return a.eventManager.remove(b.topic),!a.utils.empty(d.data.body)&&"onSuccess"in c?c.onSuccess.apply(this,[d.data.body]):!a.utils.empty(d.data.error)&&"onError"in c?c.onError.apply(this,[d.data.error]):void 0}),a.context.window.parent.postMessage(b,"*")}a.middle={};var f,g={};g._downLoaded=function(d){b(),a.widgetManager.fire("debug",{type:"log",content:"`middle` plugged"}),c()},g._notifyIncludedResources=function(b){a.eventManager.remove("_notifyIncludedResources"),a.widgetManager.fire("debug",{type:"log",content:"`middle` notify included resources"}),d(),a.utils.forwardMessage("_stopNotifying");var c=Object.assign(a.dependencyManager.getIncludedResources()||{},a.eventManager.getMessageBody(b)||{});a.utils.downwardMessage("_downInitialisation",{includedResources:c})},g._dependencyLoaded=function(b){var c=a.eventManager.getMessageBody(b);a.dependencyManager.dependencyLoaded(c),a.dependencyManager.prepareDependency(c),a.utils.forwardMessage("_dependencyLoaded",c)},g._dependencyPrepared=function(b){var c=a.eventManager.getMessageBody(b);a.dependencyManager.dependencyPrepared(c),a.utils.forwardMessage("_dependencyPrepared",c)},g._sdkLoaded=function(b){a.dependencyManager.setSDKLoaded(!0),a.dependencyManager.startDependencies(),a.utils.forwardMessage("_sdkLoaded")},g["_middle:loadResource"]=function(b){var c=a.eventManager.getMessageBody(b);if(c){var d=a.context.document.createElement("script"),e=a.context.document.getElementsByTagName("script")[0];d.async=1,d.src=c,e.parentNode.insertBefore(d,e)}},a.middle.prepare=function(){if(a.mode===a.MODE.MIDDLE.PROXY){var b="https://"+a.settings.alias+a.MASTER.BASE+a.MASTER.PATH_TO_WW+"?"+a.widgetManager.getDebugQueryParams();a.references.down=new Worker(b),a.settings=i,a.references.down.onmessage=h,a.utils.forwardMessage=j,a.utils.forwardFeedback=k,a.utils.downwardMessage=l,a.utils.downwardFeedback=m,a.context.window.addEventListener("message",h,!1),a.eventManager.bind(g),a.widgetManager.init(a.settings.widgets),a.widgetManager.fire(a.WIDGET.DEBUG,{type:"log",content:"`middle` configured"})}};var h=function(b){a.eventManager.trigger(b)},j=function(b,c,d){var f=a.utils.createPayloadMessage(b,c);if(f)return d?e(f,d):a.context.window.parent.postMessage(f,"*")},k=function(b,c,d){var e=a.utils.createPayloadFeedback(b,c,d);if(e)return a.context.window.parent.postMessage(e,"*")},l=function(b,c){var d=a.utils.createPayloadMessage(b,c);if(d)return a.references.down.postMessage(d)},m=function(b,c,d){var e=a.utils.createPayloadFeedback(b,c,d);if(e)return a.references.down.postMessage(e)},n=function(b){var c=a.eventManager.getMessageType(b);return a.eventManager.exist(c)?a.eventManager.trigger(b):a.context.window.parent.postMessage(b.data,"*")},o=function(b){var c=a.eventManager.getMessageType(b);return a.eventManager.exist(c)?a.eventManager.trigger(b):a.references.down.postMessage(b.data)}}(h),a.l=function(a){return a.apply(h)},function(a){function b(b){W=a.utils.extend(W,JSON.parse(b)),a.widgetManager.fire(a.WIDGET.DEBUG,{callee:P,contents:["Prepared with current state",W]}),void 0===W.serviceworker&&a.widgetManager.fire("debug",{callee:P,content:"non secure origin: sw unreachable"});try{c(),void 0!==W.serviceworker&&(a.widgetManager.fire("debug",{type:"info",callee:P,content:"user is currently optin"}),g())}catch(d){a.widgetManager.fire("debug",{type:"info",callee:P,contents:["user is currently optout",a.utils.errorToString(d)]}),h()}return a.eventManager.bind(U),a.logicManager.add("push:askPermission",a.push.askPermission),a.logicManager.add("push:showAlert",a.push.showAlert),a.logicManager.add("push:isCompliant",a.push.isCompliant),a.logicManager.add("push:launchLandingOnClick",p),a.logicManager.add("push:addCustomListeners",m),o(),a.utils.downwardMessage("_dependencyPrepared","push")}function c(){if("denied"===W.permission)throw O.PUSH_PERMISSION_DENIED;if("granted"!==W.permission)throw O.PUSH_PERMISSION_NOT_GRANTED;if(void 0!==W.serviceworker){if(W.serviceworker===!1)throw O.SERVICE_WORKER_NOT_ACTIVATED;if(a.utils.empty(W.token))throw O.NO_ENDPOINT_RETRIEVED}}function d(){if("denied"===W.permission)throw O.PUSH_PERMISSION_DENIED;if("granted"!==W.permission)throw O.PUSH_PERMISSION_NOT_GRANTED;if(a.utils.empty(W.token))throw O.NO_ENDPOINT_RETRIEVED}function f(){return"denied"===W.permission?Promise.reject(O.PUSH_PERMISSION_DENIED):void 0!==W.serviceworker?a.utils.empty(W.token)?Promise.resolve():Promise.reject(O.ENDPOINT_ALREADY_GENERATED):"granted"!==W.permission?Promise.resolve():new Promise(function(b,c){a.utils.downwardMessage("_core:getMe",null,{onError:function(b){return c(a.utils.errorToString(b))},onSuccess:function(a){try{a=JSON.parse(a)}catch(d){return c()}return"Y"===a.system_optin_notifs?c(O.PUSH_PERMISSION_ALREADY_GRANTED):b()}})})}function g(){a.widgetManager.fire("debug",{type:"info",callee:P,contents:["handling optin case",W.token]}),a.utils.downwardMessage("_core:updateUser",{__token:W.token,__userAuth:W.userAuth,__userPublicKey:W.userPublicKey,system_optin_notifs:"Y"})}function h(){a.widgetManager.fire("debug",{type:"info",callee:P,content:"handling optout case"}),a.utils.downwardMessage("_core:updateUser",{system_optin_notifs:"N"})}function i(b){var c=[];if("array"!==a.utils.typeOf(b))throw"Provided command options is not an array";for(var d=0;d<b.length;d++){var e=b[d];"string"!=typeof e||e.length<2||["#","."].indexOf(e.charAt(0))!==-1&&Array.prototype.push.apply(c,a.context.document.querySelectorAll(e));
}return Array.prototype.slice.call(c).filter(function(b){return"htmlanchorelement"===a.utils.typeOf(b)&&!b.hasAttribute("data-acc-push-launch-landing")})}function j(b,c){try{q(b)}catch(d){return a.widgetManager.fire("debug",{callee:P,contents:["Launching of the optinisation popup has been prevented",d]})}a.utils.downwardMessage("_fireWidget",{widget:a.WIDGET.SUBTRACK,options:{type:"event",category:c,action:"click",label:"accept"}}),a.push.launchPopup(b)}function k(){var b='a[data-acc-push-launch-landing="true"]',c=a.context.document.querySelectorAll(b);if(c.length){for(var d=0;d<c.length;d++)c[d].removeEventListener("click",X.fromLaunchLanding),c[d].removeAttribute("data-acc-push-launch-landing");a.widgetManager.fire("debug",{callee:P,content:"unbind "+c.length+" anchors on click"})}}function l(a,b){if("onError"in b)return b.onError("Current browser is not compliant for web push nor targeted by your configuration")}function m(b,c){var d;return c=c||{},"object"!==a.utils.extendedTypeOf(b)?a.utils.onError(c,"Provided command options is not an object"):(d=a.customEventManager.add(b,V),d.length?a.utils.onSuccess(c,d):a.utils.onError(c,"No listeners added"))}function n(){return Q.browsers.indexOf(a.context.browserName)!==-1&&"serviceWorker"in a.context.window.navigator&&"Notification"in a.context.window}function o(){var b={onSuccess:function(b){a.widgetManager.fire(a.WIDGET.DEBUG,{type:"success",callee:P,contents:["Scenario `"+Q.scenario+"` launched success",b]})},onError:function(b){a.widgetManager.fire(a.WIDGET.DEBUG,{type:"warning",callee:P,contents:["Scenario `"+Q.scenario+"` launched error",b]})}};switch(a.utils.grep(K,Q.scenario).length||(Q.scenario=K.NONE),a.widgetManager.fire(a.WIDGET.DEBUG,{callee:P,content:"Select scenario : `"+Q.scenario+"`"}),Q.scenario){case K.SHOW_ALERT:a.push.showAlert(null,b)}}function p(b,c){var d=[];return c=c||{},f().then(function(){return i(b)}).then(function(b){if(d=b,a.utils.empty(d))throw"No elements were binded because no Anchors </a> were provided";for(var e=0;e<d.length;e++)d[e].setAttribute("data-acc-push-launch-landing","true"),d[e].addEventListener("click",X.fromLaunchLanding,!1);return a.utils.downwardMessage("_fireWidget",{widget:a.WIDGET.SUBTRACK,options:{type:"event",category:"Launch Landing",action:"bind",value:d.length}}),a.utils.onSuccess(c,d)})["catch"](function(b){return a.utils.onError(c,a.utils.errorToString(b))})}function q(b){var c,d=a.eventManager.list();"preventDefault"in b&&"function"==typeof b.preventDefault&&b.preventDefault();for(c=0;c<d.length;c++)if(0===d[c].indexOf("acc_landing#"))throw"a popup will soon be opened";if(void 0!==N&&"closed"in N&&N.closed===!1)throw"a popup is currently opened"}function r(b){b=b||{},delete b.swUnreachable,delete b.swActivated,W=a.utils.extend(W,b||{}),a.widgetManager.fire(a.WIDGET.DEBUG,{type:"info",callee:P,contents:["Refresh state",W]})}function s(b){var c={};try{if(a.utils.empty(b))throw"sCookie is empty";if(b=JSON.parse(b),"array"!==a.utils.extendedTypeOf(b))throw"sCookie is not an array";if(c.value=b[0],c.creationDate=b[1],!a.utils.isValidDate(new Date(c.creationDate)))throw"cookieCreationDate is not a valid date";if("number"!=typeof Q.alertOptions.reAskingDelay&&Q.alertOptions.reAskingDelay>=0)throw"settings.alertOptions.reAskingDelay is not a positive number";c.delayDuration=3600*Q.alertOptions.reAskingDelay*1e3,c.delayOverdue=c.creationDate<a.utils.getISOTimestampDate(-c.delayDuration)}catch(d){return Promise.reject(d)}return Promise.resolve(c)}function t(b){if(b.value===J.DENY)throw a.utils.createCookie(I,JSON.stringify([J.DENY,a.utils.getISOTimestampDate()]),H),"User has previously denied the alert";if(b.value===J.IDDLE&&!b.delayOverdue)throw"Alert already showed, `reAskingDelay` is not overdue";a.utils.createCookie(I,JSON.stringify([J.IDDLE,a.utils.getISOTimestampDate()]),H)}function u(){var b=a.context.document.getElementById(F.ALERT_ID);if("null"===a.utils.typeOf(b))return Promise.resolve();var c=a.utils.hasClass(b,F.ALERT_ID+"--hidden");return c?Promise.resolve():Promise.reject("An alert is already displayed")}function v(){var b=a.context.document.getElementById(F.ALERT_ID);"null"!==a.utils.typeOf(b)&&b.parentNode.removeChild(b);var c,d=a.context.document.createElement("div"),e=a.context.document.getElementsByTagName("body")[0];d=w(d,Q.alertOptions.theme,Q.alertOptions.position);try{if(d.id=F.ALERT_ID,c=e.appendChild(d),"object"!=typeof c)throw new Error("Appended alert failed")}catch(f){return Promise.reject(f.message)}return Promise.resolve()}function w(b,c,d){var e=F.ALERT_ID;switch(b.innerHTML='<div id="'+e+'-body"><a href="#" id="'+e+'-close" class="'+F.CLOSE_LINK_CLASS+'"></a><div id="'+e+'-content" class="'+F.MISC_CONTENT_CLASS+'"></div></div><div id="'+e+'-buttons"><a href="#" class="'+e+"-button "+e+"-success "+F.ACCEPT_LINK_CLASS+" "+F.ACCEPT_CONTENT_CLASS+'"></a><a href="#" class="'+e+"-button "+e+"-error "+F.DENY_LINK_CLASS+" "+F.DENY_CONTENT_CLASS+'"></a></div>',c){case E.LIGHT:case E.DARK:var f=L[c],g=a.context.document.createElement("style"),h="";h+=a.utils.getCSSRule("#"+e+" *",null,["box-sizing: border-box"],["box-sizing: initial"]),h+=a.utils.getCSSRule("#"+e,["position: fixed","background: "+f.container.bg,"box-shadow: 0 1px 4px rgba(0,0,0,0.3)","overflow: hidden","font-family: Arial, Helvetica, sans-serif","z-index: 999"],["top: "+f.container.desktop.gap+"px","right: "+f.container.desktop.gap+"px","width: "+f.container.desktop.width+"px","height: auto","min-height: "+f.container.desktop.height+"px","border-radius: "+f.container.desktop.radius+"px"],["width: 100%","bottom: 0"]),h+=a.utils.getCSSRule("#"+e+"-body",["position: relative","height: auto","z-index: 1","margin-bottom: "+f.buttons.height+"px"],["width: 100%","padding: "+f.body.desktop.padding[0]+"px "+f.body.desktop.padding[1]+"px "+f.body.desktop.padding[2]+"px "+f.body.desktop.padding[3]+"px"],["width: 90%","left: 50%","padding: "+f.body.mobile.padding[0]+"px "+f.body.mobile.padding[1]+"px "+f.body.mobile.padding[2]+"px "+f.body.mobile.padding[3]+"px","transform: translateX(-50%)"]),h+=a.utils.getCSSRule("#"+e+"-close",["position: absolute","top: "+f.close.size/2+"px","height: "+f.close.size+"px","width: "+f.close.size+"px","opacity: 0.5","z-index: 2"],["right: "+(f.close.size/2-1)+"px"],["right: 8px"]),h+=a.utils.getCSSRule("#"+e+"-close:hover",["opacity: 1"]),h+=a.utils.getCSSRule("#"+e+"-close:before, #"+e+"-close:after",["position: absolute","left: "+f.close.size/4+"px",'content: " "',"width: "+(f.close.size/4-1)+"px","background-color: "+f.close.color],["height: "+(f.close.size+1)+"px"],["height: 20px"]),h+=a.utils.getCSSRule("#"+e+"-close:before",["transform: rotate(45deg)"]),h+=a.utils.getCSSRule("#"+e+"-close:after",["transform: rotate(-45deg)"]),h+=a.utils.getCSSRule("#"+e+"-content",["position: relative","left: 0","right: 0","width: auto","padding-right: 30px","color: "+f.content.color]),h+=a.utils.getCSSRule("#"+e+"-buttons",["position: absolute","bottom: 0","height: "+f.buttons.height+"px","text-align: center","line-height: "+(f.buttons.height-5)+"px"],["width: 100%"],["width: 90%","left: 50%","padding: "+f.buttons.mobile.padding[0]+"px "+f.buttons.mobile.padding[1]+"px "+f.buttons.mobile.padding[2]+"px "+f.buttons.mobile.padding[3]+"px","transform: translateX(-50%)"]),h+=a.utils.getCSSRule("#"+e+"-buttons a",["position: relative","display: inline-block","min-width: "+(f.button.width-2*f.button.padding)+"px","text-align: center","border-radius: 3px","text-decoration: none","color: #ffffff","margin-right: "+f.buttons.gap+"px","text-shadow: 0 2px rgba(0,0,0,0.2)"],["height: "+f.button.height+"px","line-height: "+f.button.height+"px","padding: 0 "+f.button.padding+"px","width: auto"],["height: 45px","line-height: 47px","padding: 0","width: 155px","max-width: 47%"]),h+=a.utils.getCSSRule("#"+e+"-buttons a:last-child",["margin-right: 0"]),h+=a.utils.getCSSRule("#"+e+"-buttons a:active",["border: none","top: 2px"]),h+=a.utils.getCSSRule("#"+e+"-buttons ."+F.ACCEPT_LINK_CLASS,["background: "+f.button.accept.bg,"border-bottom: 2px solid "+f.button.accept.bottom]),h+=a.utils.getCSSRule("#"+e+"-buttons ."+F.ACCEPT_LINK_CLASS+":hover",["background: "+f.button.accept.hover]),h+=a.utils.getCSSRule("#"+e+"-buttons ."+F.DENY_LINK_CLASS,["background: "+f.button.deny.bg,"border-bottom: 2px solid "+f.button.deny.bottom,"color: "+f.button.deny.color,"text-shadow: none"]),h+=a.utils.getCSSRule("#"+e+"-buttons ."+F.DENY_LINK_CLASS+":hover",["background: "+f.button.deny.hover]),"mobile"===a.context.devicePlatform&&(h+="@media all and (min-width: 650px) {",h+=a.utils.getCSSRule("#"+e,["background-color: rgba(0, 0, 0, 0)","box-shadow: none","padding-top: 15px"]),h+=a.utils.getCSSRule("#"+e+"-body",["min-width: 650px","background: "+f.container.bg,"width: 60%","max-width: 1200px","box-shadow: 0 1px 7px rgba(0, 0, 0, 0.3)","padding-bottom: 70px","margin-bottom: 0","z-index: 1"]),h+=a.utils.getCSSRule("#"+e+"-buttons",["min-width: 650px","background: "+f.container.bg,"width: 60%","max-width: 1200px","z-index: 2"]),h+=a.utils.getCSSRule("#"+e+"-content",["margin: 0 auto","padding: 0 30px"]),h+="}"),h+=a.utils.getCSSRule("."+e+"--left",["right: initial !important","left: "+f.container.desktop.gap+"px"]),h+=a.utils.getCSSRule("."+e+"--bottom",["top: initial !important","bottom: "+f.container.desktop.gap+"px"]),h+=a.utils.getCSSRule("."+e+"-close--left",["right: initial !important;left: "+(f.close.size/2+2)+"px"]),h+=a.utils.getCSSRule("."+e+"--hidden",["display: none"]),g.innerHTML=h,a.context.document.head.appendChild(g),"desktop"===a.context.devicePlatform&&([G.TOP_LEFT,G.BOTTOM_LEFT].indexOf(d)!==-1&&a.utils.addClass(b,e+"--left"),[G.BOTTOM_LEFT,G.BOTTOM_RIGHT].indexOf(d)!==-1&&a.utils.addClass(b,e+"--bottom"))}return a.utils.addClass(b,e+"--hidden"),a.utils.addClass(b,e+"--"+a.context.devicePlatform),b}function x(){try{var b,c=a.context.document.getElementById(F.ALERT_ID),d=c.getElementsByClassName(F.MISC_CONTENT_CLASS),e=c.getElementsByClassName(F.DENY_CONTENT_CLASS),f=c.getElementsByClassName(F.ACCEPT_CONTENT_CLASS);for(b=0;b<d.length;b++)d[b].innerHTML=a.utils.localizeContent("misc",Q.alertOptions.contents);for(b=0;b<e.length;b++)e[b].innerHTML=a.utils.localizeContent("deny",Q.alertOptions.contents);for(b=0;b<f.length;b++)f[b].innerHTML=a.utils.localizeContent("accept",Q.alertOptions.contents)}catch(g){return Promise.reject(g.message)}return Promise.resolve()}function y(){try{var b,c=a.context.document.getElementById(F.ALERT_ID),d=c.getElementsByClassName(F.ACCEPT_LINK_CLASS),e=c.getElementsByClassName(F.DENY_LINK_CLASS),f=c.getElementsByClassName(F.CLOSE_LINK_CLASS);for(b=0;b<d.length;b++)d[b].addEventListener("click",X.fromHTMLAlert,!1);for(b=0;b<e.length;b++)e[b].addEventListener("click",function(b){a.utils.downwardMessage("_fireWidget",{widget:a.WIDGET.SUBTRACK,options:{type:"event",category:"HTML Alert",action:"click",label:"deny"}}),z(b)});for(b=0;b<f.length;b++)f[b].addEventListener("click",function(b){a.utils.downwardMessage("_fireWidget",{widget:a.WIDGET.SUBTRACK,options:{type:"event",category:"HTML Alert",action:"click",label:"close"}}),B()})}catch(g){return Promise.reject(g.message)}return Promise.resolve()}function z(b){b.preventDefault(),a.utils.createCookie(I,JSON.stringify([J.DENY,a.utils.getISOTimestampDate()]),H),B()}function A(){a.utils.removeClass(F.ALERT_ID,F.ALERT_ID+"--hidden"),a.utils.addClass(F.ALERT_ID,F.ALERT_ID+"--visible")}function B(){a.utils.removeClass(F.ALERT_ID,F.ALERT_ID+"--visible"),a.utils.addClass(F.ALERT_ID,F.ALERT_ID+"--hidden")}function C(){a.widgetManager.fire("debug",{callee:P,content:"Closing the Landing Popup"}),N&&("close"in N&&"function"==typeof N.close&&N.close(),N=void 0)}a.push={};var D=["chrome","firefox"],E={BLANK:"blank",LIGHT:"light",DARK:"dark"},F={ALERT_ID:"acc-alert",CLOSE_LINK_CLASS:"acc--closeLink",DENY_LINK_CLASS:"acc--denyLink",DENY_CONTENT_CLASS:"acc--denyContent",ACCEPT_LINK_CLASS:"acc--acceptLink",ACCEPT_CONTENT_CLASS:"acc--acceptContent",MISC_CONTENT_CLASS:"acc--miscContent"},G={TOP_RIGHT:"topRight",TOP_LEFT:"topLeft",BOTTOM_RIGHT:"bottomRight",BOTTOM_LEFT:"bottomLeft"},H=720,I="acc_alert",J={IDDLE:"U",DENY:"N"},K={NONE:"none",SHOW_ALERT:"showAlert"},L={},M={container:{desktop:{gap:10,width:400,height:150,radius:4}},body:{desktop:{padding:[25,20,10,20]},mobile:{padding:[10,8,15,8]}},close:{size:12},content:{},buttons:{height:50,gap:10,mobile:{padding:[8,8,5,8]}},button:{width:100,height:35,padding:8}};L[E.LIGHT]=JSON.parse(JSON.stringify(M)),L[E.LIGHT].container.bg="#FBFBFB",L[E.LIGHT].close.color="#000000",L[E.LIGHT].content.color="#333333",L[E.LIGHT].button.deny={bg:"#CCCCCC",hover:"#BBBBBB",bottom:"#AAAAAA",color:"#444444"},L[E.LIGHT].button.accept={bg:"#4EB669",hover:"#23B05E",bottom:"#179B53"},L[E.DARK]=JSON.parse(JSON.stringify(M)),L[E.DARK].container.bg="#8C8C8C",L[E.DARK].close.color="#000000",L[E.DARK].content.color="#E9E9E9",L[E.DARK].button.deny={bg:"#FA7866",hover:"#F26755",bottom:"#C43927",color:"#FFFFFF"},L[E.DARK].button.accept={bg:"#91DBA4",hover:"#53D489",bottom:"#179B53"};var N,O={PUSH_PERMISSION_DENIED:"native push permission is denied",PUSH_PERMISSION_NOT_GRANTED:"native push permission is not granted",PUSH_PERMISSION_ALREADY_GRANTED:"native push permission is already granted",SERVICE_WORKER_NOT_ACTIVATED:"service worker is not activated/registered",NO_ENDPOINT_RETRIEVED:"no endpoint has been retrieved",ENDPOINT_ALREADY_GENERATED:"an endpoint has already been generated"},P="plugin:push",Q={},R={browsers:D,scenario:K.NONE,alertOptions:{},landingOptinOptions:{}},S={theme:E.LIGHT,position:G.TOP_RIGHT,reAskingDelay:576},T={theme:E.LIGHT,width:462,height:135},U={},V=["landingFeedback:optin","landingFeedback:softOptout","landingFeedback:hardOptout"],W={serviceworker:void 0,token:void 0,permission:void 0};U["_push:popupFeedback"]=function(b){a.widgetManager.fire("debug",{callee:P,content:"Receive feedback from popup"});var c=a.eventManager.getMessageBody(b);r(c);try{d(),a.widgetManager.fire("debug",{type:"success",callee:P,content:"user is now optin"}),g(),k(),a.customEventManager.trigger("landingFeedback:optin")}catch(e){var f=a.utils.errorToString(e);a.widgetManager.fire("debug",{type:"warning",callee:P,contents:["user is still optout",f]}),h(),f===O.PUSH_PERMISSION_DENIED?(a.customEventManager.trigger("landingFeedback:hardOptout"),k()):a.customEventManager.trigger("landingFeedback:softOptout")}},U["_push:refreshState"]=function(b){var c=a.eventManager.getMessageBody(b);return r(c)},a.push.start=function(){if(a.mode===a.MODE.TOP)return Q=a.utils.extend(R,a.settings.dependencies.push||{}),Q.alertOptions=a.utils.extend(S,Q.alertOptions),Q.landingOptinOptions=a.utils.extend(T,Q.landingOptinOptions),n()?a.utils.downwardMessage("_sw:plugin_push_prepare",null,{onSuccess:b}):(a.widgetManager.fire(a.WIDGET.DEBUG,{type:"warning",callee:P,content:"browser not compliant or targeted"}),a.logicManager.add("push:askPermission",l),a.logicManager.add("push:showAlert",l),a.logicManager.add("push:launchLandingOnClick",l),a.logicManager.add("push:isCompliant",a.push.isCompliant),a.logicManager.add("push:addCustomListeners",m),a.utils.downwardMessage("_dependencyPrepared","push"))},a.push.askPermission=function(b,c){return c=c||{},a.utils.downwardMessage("_sw:plugin_push_askPermission",null,c)},a.push.isCompliant=function(b,c){return c=c||{},"serviceWorker"in a.context.window.navigator&&"Notification"in a.context.window?Q.browsers.indexOf(a.context.browserName)===-1?a.utils.onError(c,"Browser not targeted by your configuration"):"denied"===W.permission?a.utils.onError(c,"User has denied notification permission"):a.utils.onSuccess(c):a.utils.onError(c,"Technically uncompliant for web push")},a.push.showAlert=function(b,c){var d={};return c=c||{},s(a.utils.readCookie(I)).then(function(a){return d=a,Promise.resolve(d)})["catch"](function(b){return"sCookie is empty"!==a.utils.errorToString(b)&&a.widgetManager.fire(a.WIDGET.DEBUG,{type:"warning",callee:P,contents:["Push showAlert retrieve cookie value warning",e]}),Promise.resolve(d)}).then(t).then(f).then(u).then(v).then(x).then(y).then(A).then(function(){return a.utils.downwardMessage("_fireWidget",{widget:a.WIDGET.SUBTRACK,options:{type:"event",category:"HTML Alert",action:"display"}}),a.utils.onSuccess(c)})["catch"](function(b){return a.utils.onError(c,a.utils.errorToString(b))})},a.push.launchPopup=function(b){var c="acc_landing#"+a.utils.generateUUID(),d="https://"+a.settings.alias+a.MASTER.BASE+a.MASTER.PATH_TO_LANDING+"?"+a.widgetManager.getDebugQueryParams(),e="menubar=no, status=no, scrollbars=no, toolbar=no, menubar=no, location=no, directories=no, resizable=no, width="+Q.landingOptinOptions.width+", height="+Q.landingOptinOptions.height;try{q(b)}catch(g){return a.widgetManager.fire("debug",{callee:P,contents:["Launching of the optinisation popup has been prevented",g]})}return N=a.context.window.open(d,c,e),f().then(function(){return void 0===N?Promise.reject("landing not launched"):void a.eventManager.add(c,function(){a.widgetManager.fire(a.WIDGET.DEBUG,{type:"info",callee:P,content:"Popup launched"}),a.eventManager.remove(c),B()})})["catch"](function(b){B(),C(),a.eventManager.remove(c),a.widgetManager.fire(a.WIDGET.DEBUG,{type:"warning",callee:P,contents:["Unable to launch popup",a.utils.errorToString(b)]})})};var X={fromLaunchLanding:function(a){j(a,"Launch landing")},fromHTMLAlert:function(a){j(a,"HTML Alert")}};a.dependencyManager.resourceIncluded("push","top:push")}(h),function(a){function b(){return"serviceworker"===a.utils.extendedTypeOf(d().controller)?Promise.resolve():Promise.reject(k.SERVICE_WORKER_NOT_ACTIVATED)}function c(){var b="https://"+a.settings.alias+a.MASTER.BASE+a.MASTER.PATH_TO_SW+"sw_"+a.context.browserName;return"firefox"===a.context.browserName&&(b+="desktop"===a.context.devicePlatform?"_d":"_m"),b+=".js",a.context.window.navigator.serviceWorker.register(b,{scope:"./"}).then(g)}function d(){return m?m.window.navigator.serviceWorker:a.context.window.navigator.serviceWorker}function e(b){var c=a.eventManager.getMessagePayload(b);if(!c)return a.widgetManager.fire(a.WIDGET.DEBUG,{type:"warning",callee:l,contents:["Unvalid message from SW",b]});a.widgetManager.fire(a.WIDGET.DEBUG,{callee:l,contents:["Receive message from SW",c]});var d=a.utils.empty(c.opts)||a.utils.empty(c.opts.toLocation)?a.LOCATION.MIDDLE:c.opts.toLocation;switch(d){case a.LOCATION.TOP:a.utils.forwardMessage(c.type,c.body);break;case a.LOCATION.MIDDLE:a.eventManager.trigger({data:c});break;case a.LOCATION.DOWN:a.utils.downwardMessage(c.type,c.body)}}function f(b){return b.pushManager.subscribe({userVisibleOnly:!0}).then(a.utils.toJSON).then(function(a){var b={token:a.endpoint};return"keys"in a&&(b.userPublicKey=a.keys.p256dh,b.userAuth=a.keys.auth),Promise.resolve(b)})["catch"](function(a){return Promise.reject(a)})}function g(){return b()["catch"](h)}function h(){return a.widgetManager.fire(a.WIDGET.DEBUG,{callee:l,content:"Initiating bridge..."}),new Promise(function(b,c){var d=a.utils.createIframe(a.utils.getMiddleFileURI(),a.MODE.MIDDLE.BRIDGE);d.onload=function(){a.widgetManager.fire(a.WIDGET.DEBUG,{callee:l,content:"...Bridge initiated"}),b()},"object"==typeof a.context.document.body.appendChild(d)?m=d.contentWindow:c("Invalid bridge iframe")})}function i(){return new Promise(function(b,c){a.utils.forwardMessage("_top:isContextSecure",null,{onSuccess:function(){return b()},onError:function(){return c(k.NON_SECURE_ORIGIN)}})})}a.swHandler={};var j={NAVIGATOR_PERMISSIONS:[{name:"chrome"},{name:"firefox",min:45}]},k={NON_SECURE_ORIGIN:"non secure origin: unable to reach SW",PUSH_PERMISSION_NOT_GRANTED:"push permission not granted",SERVICE_WORKER_NOT_ACTIVATED:"SW is not activated"},l="plugin:sw_handler",m=null;a.eventManager.add("_sw:plugin_push_prepare",function(c){var g=a.eventManager.getMessageTopic(c),h={};return a.swHandler.getNotificationPermission().then(function(a){h.permission=a}).then(i).then(b).then(function(){d().onmessage=e,h.serviceworker=!0}).then(function(){return"granted"!==h.permission?Promise.reject(k.PUSH_PERMISSION_NOT_GRANTED):d().ready}).then(f).then(function(b){h=a.utils.extend(h,b||{})})["catch"](function(b){a.utils.errorToString(b)===k.NON_SECURE_ORIGIN&&(h.serviceworker=void 0),a.utils.errorToString(b)===k.SERVICE_WORKER_NOT_ACTIVATED&&(h.serviceworker=!1)}).then(function(){return a.utils.forwardFeedback(g,h)})}),a.eventManager.add("_sw:get_push_subscription",function(c){var e=a.eventManager.getMessageTopic(c);return a.swHandler.getNotificationPermission().then(function(a){if("granted"!==a)return Promise.reject(k.PUSH_PERMISSION_NOT_GRANTED)}).then(i).then(b).then(function(){return d().ready}).then(f).then(function(b){return a.utils.downwardFeedback(e,b||{})})["catch"](function(b){return a.utils.downwardFeedback(e,null,a.utils.errorToString(b))})}),a.eventManager.add("_sw:plugin_push_askPermission",function(b){var c=a.eventManager.getMessageTopic(b);return a.widgetManager.fire(a.WIDGET.DEBUG,{callee:l,content:"test"}),a.swHandler.askPermission().then(function(b){"granted"===b?a.utils.forwardFeedback(c,"permission granted"):a.utils.forwardFeedback(c,null,"permission not granted")})["catch"](function(b){a.utils.forwardFeedback(c,null,"error while asking permission")})}),a.eventManager.add("_sw:broadcast",function(b){var c=a.eventManager.getMessageBody(b);a.swHandler.broadcast(c)}),a.swHandler.install=function(){return c().then(function(){return Promise.resolve()})},a.swHandler.makeSubscription=function(){return b()["catch"](function(){return Promise.reject("SW_not_fully_ready")}).then(function(){return d().ready.then(f)})},a.swHandler.broadcast=function(c){return"object"!==a.utils.extendedTypeOf(c)||a.utils.empty(c.type)?void a.widgetManager.fire(a.WIDGET.DEBUG,{type:"warning",callee:l,contents:["Unvalid message to broadcast to SW",c]}):(a.widgetManager.fire(a.WIDGET.DEBUG,{callee:l,contents:["Message to broadcast to SW",c]}),b().then(function(){return d().controller.postMessage({type:"_broadcast",body:c})})["catch"](function(){a.widgetManager.fire(a.WIDGET.DEBUG,{type:"warning",callee:l,content:"Service Worker not activated to broadcast message"})}))},a.swHandler.getNotificationPermission=function(){return a.utils.isBrowserTargeted(j.NAVIGATOR_PERMISSIONS)?a.context.window.navigator.permissions.query({name:"notifications"}).then(function(a){return"state"in a?a.state:Promise.reject()})["catch"](function(){return"none"}):Promise.resolve(a.context.window.Notification.permission)},a.swHandler.askPermission=function(b,c){return c=c||{},new Promise(function(b){a.context.window.Notification.requestPermission(function(a){return"granted"===a?("onSuccess"in c&&c.onSuccess(!0),b(a)):("onError"in c&&c.onError("notification permission not granted"),b(a))})})},a.dependencyManager.resourceIncluded("push","middle:swHandler")}(h),b()}}(a[a.AccengageWebSDKObject])}(window);